digraph statemachine {
    Disconnected -> Connected [label="Connect"];
    Connected -> Unauthorized [label="Send:Challenge"];
    // Clear branch
    Unauthorized -> "Unencrypted Authorized" [label="Receive:Challenge:Success"];
    "Unencrypted Authorized" -> "Unencrypted Authorized" [label="Send:Model"];
    "Unencrypted Authorized" -> Ready [label="Receive:Model"];
    Ready -> Disconnected [label="Disconnect"];
    // clear file OP
    Ready -> "Do Update" [label="File:Changed"];    // send update
    "Do Update" -> Ready [label="Send:Update"];
    Ready -> Sending [label="Receive:Request"];     // send file
    Sending -> Ready [label="Send File"];
    Ready -> "Receive Update" [label="Receive:Update"]; // receive update
    "Receive Update" -> Ready [label="Update Peer"];
    Ready -> Receiving [label="Receive File"];      // receive file
    Receiving -> Ready [label="File:Update"];
    // Encrypted branch, TODO
    Unauthorized -> "Encrypted Authorized" [label="Receive:Challenge:Error"];
    "Encrypted Authorized" -> Disconnected [label="Disconnect"];
    "Encrypted Authorized" -> TODO;
}
